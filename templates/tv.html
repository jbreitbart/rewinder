{% extends "base.html" %}
{% block title %}TV Shows â€” Rewinder{% endblock %}
{% block body %}
{% include "partials/nav.html" %}
<main>
    <div class="page-header">
        <h2>TV Shows</h2>
        <label class="toggle">
            <input type="checkbox"
                   {% if show_marked %}checked{% endif %}
                   hx-get="/tv"
                   hx-target="main"
                   hx-select="main"
                   hx-swap="outerHTML"
                   data-sort-by="{{ sort_by }}"
                   data-sort-dir="{{ sort_dir }}"
                   hx-vals='js:{"show_marked": event.target.checked ? "true" : "false", "sort": event.target.dataset.sortBy, "dir": event.target.dataset.sortDir}'
                   hx-push-url="true">
            Show marked
        </label>
    </div>
    <table class="media-table">
        <thead>
            <tr>
                <th><a href="/tv?show_marked={% if show_marked %}true{% else %}false{% endif %}&sort=name&dir={% if sort_by == "name" && sort_dir == "asc" %}desc{% else %}asc{% endif %}">Series</a></th>
                <th><a href="/tv?show_marked={% if show_marked %}true{% else %}false{% endif %}&sort=season&dir={% if sort_by == "season" && sort_dir == "asc" %}desc{% else %}asc{% endif %}">Season</a></th>
                <th><a href="/tv?show_marked={% if show_marked %}true{% else %}false{% endif %}&sort=added&dir={% if sort_by == "added" && sort_dir == "asc" %}desc{% else %}asc{% endif %}">Date Added</a></th>
                <th>Size</th>
                {% if is_admin %}
                <th><a href="/tv?show_marked={% if show_marked %}true{% else %}false{% endif %}&sort=marked&dir={% if sort_by == "marked" && sort_dir == "asc" %}desc{% else %}asc{% endif %}">Marked</a></th>
                {% endif %}
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for group in series_groups %}
            <tr class="series-group-row">
                <td colspan="{% if is_admin %}6{% else %}5{% endif %}">
                    <div class="series-group-header">
                        <strong>{{ group.title }}</strong>
                        <div class="series-group-actions">
                            <button class="btn btn-sm btn-primary series-group-mark-all"
                                    hx-post="/tv/series/{{ group.title|urlencode_strict }}/mark-all?show_marked={% if show_marked %}true{% else %}false{% endif %}&sort={{ sort_by }}&dir={{ sort_dir }}"
                                    hx-target="main"
                                    hx-select="main"
                                    hx-swap="outerHTML"
                                    hx-push-url="true">
                                Mark All Seasons
                            </button>
                            <button class="btn btn-sm btn-success series-group-mark-all"
                                    hx-post="/tv/series/{{ group.title|urlencode_strict }}/persist-all?show_marked={% if show_marked %}true{% else %}false{% endif %}&sort={{ sort_by }}&dir={{ sort_dir }}"
                                    hx-target="main"
                                    hx-select="main"
                                    hx-swap="outerHTML"
                                    hx-push-url="true">
                                Persist All Seasons
                            </button>
                        </div>
                    </div>
                </td>
            </tr>
            {% for item in group.seasons %}
            {% include "partials/media_row.html" %}
            {% endfor %}
            {% endfor %}
            {% if series_groups.len() == 0 %}
            <tr><td colspan="{% if is_admin %}6{% else %}5{% endif %}" class="empty">No TV shows found</td></tr>
            {% endif %}
        </tbody>
    </table>
</main>
{% endblock %}
